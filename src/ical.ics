---
layout: false
permalink: /ical
collection: events
template_engine: erb
output_ext: ics
---
<% require 'icalendar' %>
<% cal = Icalendar::Calendar.new %>
<% cal.prodid = "-//Ruby Meetup Calendar//Calendar 1.0//EN" %>
<% cal.append_custom_property("X-WR-CALNAME", "Ruby Meetup Calendar") %>
<% cal.append_custom_property("X-WR-TIMEZONE", "Etc/GMT") %>
<% cal.append_custom_property("X-PUBLISHED-TTL","PT24H") %>
<% cal.append_custom_property("X-WR-CALDESC", "Find Ruby Meetup Events") %>

<% site.collections.events.docs.each do |event| %>
  <%
  ical_event = Icalendar::Event.new
  ical_event.uid = event.url
  ical_event.dtstart = event[:datetime].to_datetime
  ical_event.dtend = event[:datetime].to_datetime + 1.hour
  ical_event.summary = event[:external_url]
  ical_event.url = event[:external_url]
  ical_event.status = "CONFIRMED"
  ical_event.transp = "TRANSPARENT"
  ical_event.sequence = 0
  cal.add_event(ical_event)
  %>
<% end %>

<% cal.publish %>
<%= cal.to_ical %>
